name: Casal2 release action
on: [push, pull_request]
## for a release idea linux is fairly easy
## for windows look at this example https://github.com/freenet/wininstaller-innosetup/actions/runs/768471071/workflow
jobs:
  Compile-Casal2-Windows:
    runs-on: windows-latest 
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2    
        with:
          python-version: '3.8'
      - name: Install python dependencies
        run: pip install pytz python-dateutil --upgrade pip

      - name: Build installer iss file
        run: |
          cd BuildSystem
          ./doBuild.bat installer    
      - uses: eskatos/gradle-command-action@v1
        with:
          arguments: updateSetupFile

      - name: Building the installer
        run: |
          cd BuildSystem
          "%programfiles(x86)%\Inno Setup 6\iscc.exe" "config.iss"
        shell: cmd  
      - name: Sign the installer
        uses: nextgens/authenticode-sign-action@v1.0.1   
        with:
          certificate: '${{ secrets.CERTIFICATES }}'
          credentials: '${{ secrets.GOOGLE_APPLICATION_CREDENTIALS }}'            
          folder: "Casal2"
          recursive: true                      
      - name: Upload the installer as an artifact
        uses: actions/upload-artifact@v2
        with:
          path: "Casal2/Casal2_setup.exe"
          name: wininstaller-innosetup
          

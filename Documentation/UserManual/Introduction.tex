\section{Introduction\label{sec:Introduction}}

\subsection{\I{About \CNAME}}

\CNAME\ is an open-source integrated statistical catch-at-age or catch-at-length assessment tool for modelling the population dynamics of marine populations. \CNAME\ is designed for quantitative assessments of marine populations, including fish, invertebrates, marine mammals and seabirds.

\CNAME\ implements generalised age (\CNAME\ for age-based models) or length structured (\CNAME\ for length-based models) population models that allows for a great deal of choice in specifying the population dynamics, parameters and which parameters should be estimated, and the model outputs. \CNAME\ is designed for flexibility. It allows implementation of age or length structured models from single species or stocks, to multiple species or stocks, using user-defined categories such as area, sex, and maturity stage. The categories are generic, are not predefined, and are easily specified. \CNAME\ models can be used for a single population with a single anthropogenic event (i.e., a single fish stock with a single fishery), or for multiple species and populations, areas, and/or anthropogenic or exploitation methods, and can include predator-prey interactions.

In \CNAME\ the processes and observations that occur over each year are defined by the user. Processes include recruitment, natural mortality, and anthropogenic mortality. Observations used to fit the models can be from many different sources, including removals-at-size or -age (e.g., a fishery), research survey or other biomass indices, and mark-recapture data. Model parameters can be estimated using penalised maximum likelihood or Bayesian methods.

As well as the point estimates of the parameters, \CNAME\ can calculate the likelihood or posterior distribution profiles for estimated parameters, and can generate Bayesian posterior distributions using Markov chain Monte Carlo methods. \CNAME\ can project the population status into the future using either deterministic or stochastic population dynamics. \CNAME\ can also simulate observations from a given model for both existing and potential observations.

The \CNAME\ user manual has been split into two separate manuals for the age-based functionality and for the length-based functionality. These two manuals contain many common components but differ in processes and observations. \ifAgeBased
This manual is for age-based models. For length-based models, see the \CNAME\ user manual for length-based models. 
\else
This manual is for length-based models. For age-based models, see the \CNAME\ user manual for age-based models. 
\fi % end if


\subsection{\I{Citing \CNAME}}

The reference for this document is: \ManualRef

The peer-reviewed journal article reference for \CNAME\ is \cite{doonan_casal2}.

\CNAME\ has also been simulation tested using simulated data from CASAL to validate results \citep{dunn_integrated_2022}.

\subsection{\I{\CNAME\ Contributors}}

The \CNAME\ project is maintained by the \CNAME\ Development Team. \CNAME\ was initiated by Alistair Dunn. The software architect and lead author of the software code was Scott Rasmussen. Contributors to the development of \CNAME\ are Scott Rasmussen, Alistair Dunn, Ian Doonan, Craig Marsh, Teresa A'mar, Kath Large, Sophie Mormede, Samik Datta, Matt Dunn, Jingjing Zhang, Marco Kienzle, and Arnaud Gr\"{u}ss.

The development of \CNAME\ was funded by \href{http://www.niwa.co.nz}{National Institute of Water \& Atmospheric Research Ltd. (NIWA)}, with additional funding from the New Zealand \href{http://www.mpi.govt.nz}{Ministry for Primary Industries}. More recent developments of this version were funded by Ocean Environmental Ltd.

\subsection{\I{Software license}}

This program and the accompanying materials are made available under the terms of the \href{http://www.opensource.org/licenses/GPL-2.0}{GNU General Public License version 2} which accompanies this software (see Section \ref{sec:License}).

Copyright \copyright 2024-, Scott Rasmussen (scott@zaita.com). All rights reserved.
Copyright \copyright 2016-2023, \href{https://www.niwa.co.nz}{\Organisation}. All rights reserved.

\subsection{\I{Where to get \CNAME }}

This version of \CNAME\ is hosted on GitHub, and can be found at \url{https://github.com/Casal2/CASAL2}\index{GitHub}.

There are installation packages available for Linux and Microsoft Windows. Release versions of the package includes the \CNAME\ binary, the \CNAME\ \R\ library, the \CNAME\ User Manual and associated documentation, example models, and other information. The installation packages for older versions of \CNAME\ can be downloaded at \url{https://github.com/Casal2/CASAL2/releases}. For more recent versions of the compiled packages, please contact the \CNAME\ Development Team. 

See \url{https://www.niwa.co.nz/} or \url{https://github.com/Casal2/CASAL2} for more information about \CNAME.

\subsection{\I{System requirements}}

\CNAME\ is available for most x86 compatible machines running 64-bit \I{Linux} and \I{Microsoft Windows} operating systems. \CNAME\ has not been compiled nor tested on MacOS.

Several of \CNAME's tasks are computer intensive and a fast processor is recommended. Depending on the model implemented, some of the \CNAME\ tasks can take a considerable amount of processing time (minutes to hours), and in extreme cases may even take several days to complete an MCMC estimate.

Output files have the potential to be large, and the output from developing a model, sensitivity analyses, and running multiple MCMC chains can take up significant amounts of disk space\index{Disk space}. Depending on the number and type of user output requests, the output could range from a few hundred kilobytes to several hundred megabytes. When estimating model fits, several hundred megabytes of RAM may be required, depending on the spatial size of the model, number of categories, and complexity of processes and observations. For larger models, several gigabytes of RAM and disk space may occasionally be required.

\subsection{\I{Necessary files}}

For both 64-bit Linux and Microsoft Windows, we recommend using the zip files available on \github\ for Microsoft Windows and Linux; older Linux systems can use Casal2.tar.gz. Running \CNAME\ on a system requires the main binary ("casal2.exe" on Windows, or "casal2" on Linux) and the associated dynamically linked libraries (DLL) for Windows or shared objects (.so) for Linux, and cannot be (easily) run by copying the binary to a working directory. \CNAME\ is not available for 32-bit operating systems or MacOS.

\CNAME\ does not post-process model output. \CNAME\ writes all output to text files --- either to standard output or directed to files. A package that allows tabulation and graphing of model outputs is recommended. Software such as \href{http://www.r-project.org}{\R}\ \citep{R} is recommended. The \CNAME\ \R\ package is provided for extracting \CNAME\ output from reports and output files into \R\ (see Section \ref{sec:PostProcessing}). A separate \R\ package, r4Casal2, is also available on GitHub and provides some examples of diagnostic and plot functionality.

\subsection{Getting help\index{Getting help}\index{User assistance}\index{Repoerting issues or errors}}

\CNAME\ is distributed as unsupported software. Please notify the \CNAME\ Development Team of any issues with or errors in \CNAME. Please contact the \emaillink. See Section \ref{sec:ReportingErrors} for the guidelines for reporting issues. Note that \CNAME\ is a complex program, with many different options and possibilities, and we may not be able to provide any useful help if you submit an error report that does not follow the guidelines.

\subsection{Technical details\index{Technical specifications}}\label{sec:TechnicalDetails}

The source code\index{\CNAME\ source code} for \CNAME\ is available in the GitHub repository at \github. \CNAME\ is compiled on GitHub using GitHub Actions on host operating systems Microsoft Windows Server 2019 and Ubuntu 20.04.

\CNAME\ was compiled on Linux using \texttt{gcc} (\url{https://gcc.gnu.org}), the C/C++ compiler developed by the GNU Project. The 64-bit Linux \index{Linux} version was compiled using \texttt{gcc} version 10.3.0). 

The Microsoft Windows  (\url{https://www.microsoft.com})\index{Microsoft Windows} version was compiled using TDM-gcc (\url{https://jmeubank.github.io/tdm-gcc/}) using \texttt{gcc} 10.3.0 (\url{http://gcc.gnu.org})\index{gcc}. The Microsoft Windows (\url{https://www.microsoft.com}) installer was previously built using the Inno Setup (\url{https://jrsoftware.org/isdl.php}). \textbf{Note:} for some previous gcc versions, there have been issues related to threading. This was indicated by failed unit tests which rely on threading such MCMCHamiltonian etc.

\CNAME\ includes several minimisers; different minimisers may perform better for some models than others. These include both numerical differences minimisers and automatic differentiation minimisers. Numerical differences minimisers will usually work for most problems, albeit more slowly than auto-differentiation based minimisers. The numerical differences minimisers are:

\begin{enumerate}
\item Numerical differences: A minimiser that is closely based on the main algorithm of \cite{779}, that uses finite difference gradients\index{Finite differences minimiser}.
\item deltadiff: A multithreaded version of the numerical differences, but with $tan$ rescaling instead of $arcsin$ and available for use with the Hamiltonian Monte Carlo MCMC algorithm.
\item DESolver: The differential evolution solver\index{Differential evolution minimiser} \citep{1442}, based on code by \href{mailto:<godwin@pushcorp.com>}{Lester E. Godwin} of \href{http://www.pushcorp.com}{PushCorp, Inc.}
\end{enumerate}

There are two auto-differentiation minimisers, both based on ADOL-C. These are
\begin{enumerate}
\item Betadiff: A minimiser using an older version of ADOL-C (v1.8.4) that was used as the automatic differentiation minimiser in CASAL \citep{1388}, with the same minimising algorithm as used for the finite differences minimiser above, but based on the gradient from the auto-differentiation chain.
\item ADOL-C: A minimiser using version of ADOL-C (v2.5.1) \citep{walther1996adolc};, with a similar minimising algorithm as used for the finite differences minimiser above, but based on the gradient from the auto-differentiation chain.
\end{enumerate}

The random number generator\index{Random number generator} used in \CNAME\ uses an implementation of the Mersenne twister random number generator \citep{796}. This functionality, the command line functionality, matrix operations, and a number of other functions use the \href{http://www.boost.org/}{Boost} C++ library (Version 1.71.0)\index{Boost C++ library}.

Note that the output from \CNAME\ may differ slightly on the different operating systems and operating system versions due to different precision arithmetic or other platform-dependent (including CPU hardware) implementation details. In particular, the implementation of the standard C++ library \texttt{math.h} differs slightly on different platforms, and hence the results from different platforms may be different.

\CNAME\ uses unit tests and post-compile model validations to verify the source code. Unit tests of the underlying \CNAME\ code are run at build time using the \href{https://github.com/google/googletest}{Google Test and Mock} unit testing and mocking framework. The unit test framework aims to cover a significant proportion of the key functionality within the \CNAME\ code base. The unit test code\index{Unit tests} for \CNAME\ is available as a part of the underlying source code. Post-compile models are run using Python scripts at the end of every build and with each commit to the GitHub repository. See Appendix \ref{sec:buildrules} for more information. 


